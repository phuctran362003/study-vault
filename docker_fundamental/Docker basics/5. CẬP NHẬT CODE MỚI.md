# Cập Nhật Code Mới trong Docker Container

Làm thế nào để cập nhật code mới vào một container đã được đóng gói? Bài viết này sẽ giải quyết vấn đề đó với hai cách tiếp cận chính.

## Cách 1: Build Lại Image Từ Đầu

Phương pháp này bao gồm việc xây dựng lại image Docker từ đầu mỗi khi có thay đổi về code.

### 1. Build lại Image

Sử dụng câu lệnh build image đã biết:

```bash
docker build -t library-manager .
```

### 2. Chạy Container từ Image Mới

Sau khi build image mới, tiến hành chạy container:

```bash
docker run -d -p 8080:8080 -p 8081:8081 --name library-manager-container library-manager
```

### 3. Xử lý Xung đột (Nếu có)

*   **Nếu trùng cổng (port) cũ:** Bạn cần dừng (kill) container cũ đang sử dụng cổng đó.

    ```bash
    docker stop <container-id>
    ```

*   **Nếu trùng tên (name) container:** Bạn cần xóa (remove) container cũ có tên đó.

    ```bash
    docker rm <container-id>
    ```

## Cách 2: Hot Reload (Tiện lợi hơn cho phát triển)

Cách này cho phép code thay đổi được tự động cập nhật trong container mà không cần build lại image hay khởi động lại container, rất tiện lợi cho quá trình phát triển.

### 1. Cập nhật Dockerfile để Bật Hot Reload

Bạn cần chỉnh sửa `Dockerfile` để kích hoạt tính năng hot reload. Cụ thể, thay đổi lệnh `ENTRYPOINT` để sử dụng `dotnet watch run`.

```dockerfile
# Sử dụng SDK để phát triển
FROM mcr.microsoft.com/dotnet/sdk:8.0 AS dev

# Cấu hình thư mục làm việc
WORKDIR /app

# Sao chép file project và restore dependencies
COPY ["LibraryManager.csproj", "."]
RUN dotnet restore "./LibraryManager.csproj"

# Sao chép toàn bộ mã nguồn
COPY . .

# Cấu hình lệnh chạy ứng dụng với hot reload
ENTRYPOINT ["dotnet", "watch", "run", "--urls", "http://0.0.0.0:8080"]
```

### 2. Các Bước Build và Run Container với Hot Reload

*   **Build image với tag `dev`:**

    ```bash
    docker build -t library-manager:dev -f Dockerfile .
    ```

*   **Chạy container và mount volume:**

    ```bash
    docker run -d \
      -p 8080:8080 \
      -v /mnt/d/FPT/projects/docker-libraryManager:/app \
      --name library-manager-hot \
      library-manager:dev
    ```

    **Giải thích:**
    *   `-v <project-path>:/app`: Đây là lệnh *Volume mount*. Nó kết nối thư mục chứa mã nguồn trên máy chủ (host) của bạn (`/mnt/d/FPT/projects/docker-libraryManager` trong ví dụ này) với thư mục làm việc bên trong container (`/app`). Nhờ đó, mọi thay đổi bạn thực hiện trên code ở máy host sẽ được phản ánh ngay lập tức trong container.
