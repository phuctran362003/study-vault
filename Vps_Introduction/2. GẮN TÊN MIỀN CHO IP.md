# Hướng dẫn Gắn Tên miền cho IP VPS với Nginx và HTTPS

Tài liệu này hướng dẫn cách cấu hình tên miền cho IP của VPS, sử dụng Nginx làm reverse proxy và Let's Encrypt để cài đặt HTTPS.

## 1. Thêm Record DNS trên Cloudflare (hoặc nhà cung cấp DNS khác)

Để tên miền của bạn trỏ về IP của VPS, bạn cần thêm một bản ghi `A` trong cài đặt DNS của tên miền.

*   **Type:** `A`
*   **Name:** `subdomain` (Ví dụ: `skibidi` nếu bạn muốn `skibidi.ae-tao-fullstack.site`, hoặc `@` nếu bạn muốn tên miền chính `ae-tao-fullstack.site`)
*   **Content:** `103.211.201.162` (IP VPS của bạn)
*   **Proxy Status:** `DNS Only` (hoặc `Proxied` nếu muốn Cloudflare bảo vệ và quản lý SSL)
*   **TTL:** `Auto`

## 2. Tạo File Cấu hình Nginx cho Tên miền/Subdomain

Tạo một file cấu hình Nginx mới cho tên miền hoặc subdomain của bạn.

```bash
sudo nano /etc/nginx/sites-available/<tên-của-subdomain-hoặc-domain>
```

Ví dụ:
```bash
sudo nano /etc/nginx/sites-available/api.ae-tao-fullstack.site
```

Thêm cấu hình sau vào file (thay đổi `your_domain.com` và `PORT` theo ứng dụng của bạn):

```nginx
server {
    listen 80;
    server_name your_domain.com; # Ví dụ: api.ae-tao-fullstack.site

    location / {
        proxy_pass http://localhost:PORT; # Đổi PORT theo ứng dụng của bạn (ví dụ: 5000 cho .NET API)
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_connect_timeout 300;
        proxy_send_timeout 300;
        proxy_read_timeout 300;
        send_timeout 300;
    }
}
```

## 3. Kích hoạt Cấu hình Nginx

Tạo symbolic link từ `sites-available` sang `sites-enabled` để kích hoạt cấu hình Nginx mới.

```bash
sudo ln -s /etc/nginx/sites-available/<tên-của-subdomain-hoặc-domain> /etc/nginx/sites-enabled/
```

## 4. Kiểm tra Cấu hình và Khởi động lại Nginx

Kiểm tra cú pháp cấu hình Nginx để đảm bảo không có lỗi, sau đó khởi động lại dịch vụ Nginx.

```bash
sudo nginx -t
```

Nếu không có lỗi, khởi động lại Nginx:

```bash
sudo systemctl restart nginx
```

## 5. Cấu hình HTTPS với Let's Encrypt (Khuyến nghị)

Để bảo mật kết nối, bạn nên cài đặt chứng chỉ SSL/TLS miễn phí từ Let's Encrypt bằng Certbot.

Cài đặt Certbot và plugin Nginx:

```bash
sudo apt install certbot python3-certbot-nginx -y
```

Chạy Certbot để lấy và cài đặt chứng chỉ SSL:

```bash
sudo certbot --nginx -d your_domain.com # Thay your_domain.com bằng tên miền của bạn
```

Ví dụ:
```bash
sudo certbot --nginx -d api.ae-tao-fullstack.site
```

Certbot sẽ tự động cấu hình Nginx để sử dụng HTTPS và thiết lập chuyển hướng HTTP sang HTTPS.

## 6. Kiểm tra Kết quả

Truy cập tên miền của bạn qua HTTPS để kiểm tra xem cấu hình đã thành công chưa.

```
https://your_domain.com
```

Ví dụ:
```
https://api.ae-tao-fullstack.site
```
