
Nginx Proxy Manager (NPM) là một công cụ tuyệt vời giúp bạn dễ dàng quản lý các reverse proxy, tạo chứng chỉ SSL miễn phí từ Let's Encrypt và chuyển hướng lưu lượng truy cập đến các dịch vụ của mình mà không cần phải cấu hình Nginx thủ công.

Hướng dẫn này sẽ chỉ cho bạn cách cài đặt NPM bằng Docker Compose, một phương pháp nhanh chóng và tiện lợi, phù hợp cho cả người mới bắt đầu và người dùng nâng cao.

## I. Cài đặt cơ bản với SQLite (Khuyến nghị cho người mới bắt đầu)

Đây là cách cài đặt đơn giản nhất, sử dụng cơ sở dữ liệu SQLite được tích hợp sẵn, hoàn hảo để bắt đầu nhanh chóng.

Đầu tiên, hãy tạo một file tên là `docker-compose.yml` với nội dung dưới đây. File này sẽ định nghĩa cách Docker chạy ứng dụng NPM cho bạn.

```yaml
services:
  app:
    image: 'jc21/nginx-proxy-manager:latest'
    restart: unless-stopped
    ports:
      # Các cổng này cho phép truy cập từ bên ngoài vào container
      - '80:80'   # Cổng HTTP công khai
      - '443:443' # Cổng HTTPS công khai
      - '81:81'   # Cổng để truy cập giao diện quản trị NPM
    environment:
      TZ: "Asia/Ho_Chi_Minh" # Đặt múi giờ của bạn để hiển thị thời gian chính xác
    volumes:
      # Các dòng này "mount" thư mục từ máy của bạn vào container
      # để lưu trữ dữ liệu quan trọng, tránh bị mất khi container khởi động lại.
      - ./data:/data
      - ./letsencrypt:/etc/letsencrypt
```

Trong file này, chúng ta định nghĩa một dịch vụ `app` sử dụng image chính thức của NPM. Chúng ta mở các cổng cần thiết: 80 và 443 cho web traffic, và 81 cho giao diện quản trị. Quan trọng nhất là hai thư mục `data` và `letsencrypt` được liên kết vào container để lưu trữ toàn bộ cấu hình và chứng chỉ SSL của bạn.

Sau khi tạo file, bạn chỉ cần chạy lệnh sau để khởi động NPM:

```bash
docker compose up -d
```

## II. Cấu hình nâng cao với MySQL hoặc MariaDB

Khi hệ thống của bạn lớn hơn, việc sử dụng một cơ sở dữ liệu chuyên dụng như MySQL hoặc MariaDB sẽ mang lại hiệu suất và khả năng quản lý tốt hơn. Dưới đây là cách cấu hình NPM để kết nối với một container MariaDB.

File `docker-compose.yml` của bạn sẽ trông như sau:

```yaml
services:
  app:
    image: 'jc21/nginx-proxy-manager:latest'
    restart: unless-stopped
    ports:
      - '80:80'
      - '443:443'
      - '81:81'
    environment:
      TZ: "Asia/Ho_Chi_Minh"
      # Cung cấp thông tin để NPM kết nối đến cơ sở dữ liệu MariaDB
      DB_MYSQL_HOST: "db"
      DB_MYSQL_PORT: 3306
      DB_MYSQL_USER: "npm"
      DB_MYSQL_PASSWORD: "npm"
      DB_MYSQL_NAME: "npm"
    volumes:
      - ./data:/data
      - ./letsencrypt:/etc/letsencrypt
    # Đảm bảo container 'db' được khởi động trước 'app'
    depends_on:
      - db

  # Đây là dịch vụ cơ sở dữ liệu MariaDB
  db:
    image: 'jc21/mariadb-aria:latest'
    restart: unless-stopped
    environment:
      MYSQL_ROOT_PASSWORD: 'npm'
      MYSQL_DATABASE: 'npm'
      MYSQL_USER: 'npm'
      MYSQL_PASSWORD: 'npm'
      MARIADB_AUTO_UPGRADE: '1'
    volumes:
      - ./mysql:/var/lib/mysql
```

> **CẢNH BÁO**
> Khi bạn cung cấp thông tin kết nối MySQL (`DB_MYSQL_*`), NPM sẽ ưu tiên sử dụng nó và bỏ qua SQLite.

## III. Cấu hình với Postgres

Tương tự, nếu bạn quen thuộc với Postgres, NPM cũng hỗ trợ hoàn toàn. Cấu trúc file `docker-compose.yml` cũng bao gồm hai dịch vụ `app` và `db` cho Postgres.

```yaml
services:
  app:
    # ... cấu hình tương tự như trên ...
    environment:
      TZ: "Asia/Ho_Chi_Minh"
      # Thông số kết nối Postgres:
      DB_POSTGRES_HOST: 'db'
      DB_POSTGRES_PORT: '5432'
      DB_POSTGRES_USER: 'npm'
      DB_POSTGRES_PASSWORD: 'npmpass'
      DB_POSTGRES_NAME: 'npm'
    # ...
    depends_on:
      - db

  db:
    image: postgres:17
    environment:
      POSTGRES_USER: 'npm'
      POSTGRES_PASSWORD: 'npmpass'
      POSTGRES_DB: 'npm'
    volumes:
      - ./postgresql:/var/lib/postgresql
```

## IV. Lưu ý khi chạy trên Raspberry Pi và thiết bị ARM

Một điểm cộng lớn của NPM là nó rất nhẹ và có thể chạy mượt mà trên các thiết bị ARM như Raspberry Pi. Image Docker chính thức đã được xây dựng để hỗ trợ đa kiến trúc, vì vậy bạn không cần làm gì đặc biệt cả, cứ theo hướng dẫn như trên là được.

> **LƯU Ý**
> Nếu bạn chọn sử dụng MariaDB, hãy lưu ý rằng image `jc21/mariadb-aria:latest` có thể không tương thích với một số thiết bị ARM. Trong trường hợp đó, bạn có thể thử một image thay thế như `yobasystems/alpine-mariadb:latest`.

## V. Chào mừng đến với Nginx Proxy Manager!

Sau khi bạn chạy lệnh `docker compose up -d`, hãy kiên nhẫn một chút. Trong lần khởi động đầu tiên, NPM sẽ tự động thực hiện một vài tác vụ thiết lập ban đầu như tạo khóa bảo mật, khởi tạo cấu trúc cơ sở dữ liệu và tạo một tài khoản quản trị viên mặc định. Quá trình này có thể mất vài phút.

Khi hoàn tất, bạn có thể truy cập giao diện quản trị tại `http://<địa-chỉ-ip-của-bạn>:81`.

**Thông tin đăng nhập mặc định:**
- **Email:** `admin@example.com`
- **Mật khẩu:** `changeme`

Bạn sẽ được yêu cầu thay đổi thông tin này ngay sau lần đăng nhập đầu tiên. Chúc bạn thành công!