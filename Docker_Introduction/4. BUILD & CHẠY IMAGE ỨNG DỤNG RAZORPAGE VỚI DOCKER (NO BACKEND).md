# Xây dựng và Chạy Ứng dụng Razor Page với Docker (Không Backend)

## 1. Viết Image bằng Dockerfile

Trong Docker, một *image* có thể được hình dung như một "công thức" để tạo ra một "hộp cơm" (container). Vậy làm thế nào để tạo ra các image này?

Chúng ta sẽ viết một `Dockerfile`. `Dockerfile` chứa các chỉ dẫn để xây dựng một image, tức là các bước để tạo nên một container hoàn chỉnh.

## 2. Các Câu Lệnh CLI Cơ Bản

### 2.1. `docker image`

Đây là nhóm lệnh tổng quát liên quan đến việc quản lý các Docker image. Khi bạn gõ `docker image`, Docker sẽ hiển thị danh sách các lệnh con có thể sử dụng, tương tự như một menu:

*   `ls`: Liệt kê danh sách image.
*   `pull`: Tải image từ Docker Hub.
*   `rm`: Xóa image.
*   `inspect`: Xem thông tin chi tiết về một image.

### 2.2. `docker image ls`

Lệnh này cụ thể hơn: Liệt kê các image có sẵn trên máy của bạn. Nó giống như việc bạn kiểm tra tủ lạnh xem có gì bên trong.

```bash
docker image ls
```

**Output ví dụ:**

```
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
my-razor-app        latest              abcdef123456        2 days ago          200MB
```

## 3. Thành Phần Cơ Bản của Dockerfile

*Lưu ý: Dấu `#` được dùng để comment trong Dockerfile.*

### 3.1. Syntax

### 3.2. `FROM`

Xác định *base image* (image nền) mà container sẽ được khởi tạo từ đó.

*Ví dụ:* Với ứng dụng Razor Page .NET 8, chúng ta sử dụng image nền của Microsoft:

```dockerfile
FROM mcr.microsoft.com/dotnet/aspnet:8.0
```

### 3.3. `WORKDIR`

Đặt thư mục làm việc mặc định bên trong container.

```dockerfile
WORKDIR /app
```

### 3.4. `COPY`

Sao chép file từ máy chủ (host) vào container.

*Ví dụ:*

```dockerfile
COPY . .
```

### 3.5. `RUN`

Chạy một lệnh trong quá trình build image.

*Ví dụ:*

```dockerfile
RUN dotnet restore
```

### 3.6. `CMD` hoặc `ENTRYPOINT`

Xác định lệnh sẽ được chạy khi container khởi động.

*Ví dụ:*

```dockerfile
ENTRYPOINT ["dotnet", "razorpage-app.dll"]
```

### 3.7. `EXPOSE`

Xác định cổng mà ứng dụng trong container sẽ lắng nghe.

```dockerfile
EXPOSE 80
```

## 4. Dockerfile Hoàn Chỉnh cho một Solution .NET 8.0 (Ví dụ)

Hãy tự tạo một project của riêng bạn. Ví dụ dưới đây là cho project `LibraryManager`.

```dockerfile
# Sử dụng SDK để phát triển
FROM mcr.microsoft.com/dotnet/sdk:8.0 AS dev

# Cấu hình thư mục làm việc
WORKDIR /app

# Sao chép file project và restore dependencies
COPY ["LibraryManager.csproj", "."]
RUN dotnet restore "./LibraryManager.csproj"

# Sao chép toàn bộ mã nguồn
COPY . .

ENTRYPOINT ["dotnet", "run", "--urls", "http://0.0.0.0:8080"]
```

*Lưu ý:*
*   Dockerfile này thường được Visual Studio tự động tạo.
*   `http://0.0.0.0:8080` là cổng của container, cần *ghi nhớ kỹ*.

## 5. Sau khi Viết Dockerfile, Làm Gì Tiếp Theo?

### 5.1. Tiến hành Build Image

Sử dụng lệnh sau để build image từ Dockerfile:

```bash
docker build -t library-manager .
```

**Giải thích:**
*   `docker build`: Lệnh để tạo image từ Dockerfile.
*   `-t library-manager`: Đặt tên (tag) cho image là `library-manager`.
*   `.` (dấu chấm): Chỉ định rằng Dockerfile nằm trong thư mục hiện tại.

### 5.2. Chạy Container từ Image

Chạy thử container từ image vừa build:

```bash
docker run -d -p 8080:8080 -t library-manager
```

*Lưu ý:*
*   `8080` (bên phải) là cổng của container, nó phải *giống* với cổng được khai báo trong dòng `ENTRYPOINT` của Dockerfile.
*   `8080` (bên trái) là cổng của máy host (máy cục bộ của bạn), bạn có thể chọn bất kỳ số cổng nào khác nếu muốn.

**Giải thích:**
*   `-d`: Chạy container ở chế độ nền (detached).
*   `-p 8080:8080`: Ánh xạ cổng 8080 của host đến cổng 8080 của container.
*   `-t library-manager`: Sử dụng image có tên `library-manager`.

### 5.3. Kiểm tra Container Đang Chạy

Để kiểm tra các container đang chạy:

```bash
docker ps
```

**Output ví dụ:**

```
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                     NAMES
cf2cb91fe9d7        library-manager     "dotnet LibraryManag…"   5 seconds ago       Up 3 seconds        0.0.0.0:8080->8080/tcp    library-manager-container
```

### 5.4. Xóa Tất Cả Image và Container

Nếu bạn muốn xóa *toàn bộ* containers, images, volumes và networks, hãy chạy lệnh này:

```bash
docker system prune -a --volumes
```